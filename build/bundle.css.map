{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "..\\..\\Playground.svelte"
  ],
  "sourcesContent": [
    "<script>\r\n\timport { onMount } from 'svelte'\r\n\timport { gameWidth, gameHeight, volumeCoefficient, sensitivity as sensitivityStore, score, level, blocks, pixelRatio }\r\n\t\tfrom './props.js'\r\n\r\n\timport Timer from './Timer.js'\r\n\timport { Player } from './Player.js'\r\n\timport { Text } from './Text.js'\r\n\timport { Block } from './Block.js'\r\n\r\n\t// export let width\r\n\t// export let height\r\n\tlet width\r\n\tlet height\r\n\t\r\n\tlet canvas\r\n\tlet startScreen\r\n\tlet crashScreen\r\n\tlet startButton\r\n\tlet restartButton\r\n\t$: sensitivity = $sensitivityStore\r\n\tlet meter\r\n\tlet audioContext\r\n\tlet mediaStreamSource\r\n\tlet recycle\r\n\tlet lastBlockDeployedAt\r\n\r\n\tlet mount = () => {\r\n\t\t// create canvas context\r\n\t\tlet context = canvas.getContext('2d')\r\n\r\n\t\t// update gameWidth and gameHeight\r\n\t\tpixelRatio.set(window.devicePixelRatio)\r\n\t\tgameWidth.set(width)\r\n\t\tgameHeight.set(height)\r\n\r\n\t\tlet volumeText \t= new Text(context, 10, 20, 'Volume: 0')\r\n\t\tlet scoreText \t= new Text(context, 100, 20, 'Score: `${$score}`')\r\n\t\tlet levelText \t= new Text(context, 170, 20, 'Level: `${$level}`')\r\n\t\t\r\n\t\tlet backgroundImage = new Image(); \r\n\t\tbackgroundImage.src = './dirtbg.png';\r\n\t\t\r\n\t\tlet dirtImage = new Image(); \r\n\t\tdirtImage.src = './dirt.png';\r\n\t\t\r\n\t\t// Push a player\r\n\t\tlet player  \t= new Player(context, dirtImage, width / 10, height / 2)\r\n\t\t\r\n\t\tblocks.set([\r\n\t\t\t// new Block(context, $level)\r\n\t\t])\r\n\r\n\r\n\t\t// we'll deploy new block\r\n\t\tlet deploymentGap = (4000 - (($level-1) * 250));\r\n\t\t// console.log(deploymentGap, (Date.now()-lastBlockDeployedAt))\r\n\t\t// console.log(Date.now() - lastBlockDeployedAt)\r\n\t\tsetInterval(() => {\r\n\t\t\tif( !lastBlockDeployedAt || (Date.now() - lastBlockDeployedAt) > deploymentGap  )\r\n\t\t\t{\r\n\t\t\t\tblocks.update(v => {\r\n\t\t\t\t\tlet _block = new Block(context, $level)\r\n\t\t\t\t\tv.push( _block )\r\n\t\t\t\t\treturn v\r\n\t\t\t\t})\r\n\r\n\t\t\t\tlastBlockDeployedAt = Date.now()\r\n\t\t\t}\r\n\t\t}, 100)\r\n\r\n\t\t// Animate-recycle\r\n\t\trecycle = new Timer(async function(){\r\n\r\n\t\t\t// update gameWidth and gameHeight\r\n\t\t\tpixelRatio.set(window.devicePixelRatio)\r\n\t\t\tgameWidth.set(width / 1)\r\n\t\t\tgameHeight.set(height / 1)\r\n\t\t\t// gameWidth.set(width / ($pixelRatio))\r\n\t\t\t// gameHeight.set(height / ($pixelRatio))\r\n\r\n\t\t\t// let volume = (meter ? meter.volume : 0) * $volumeCoefficient * ((($sensitivityStore+100.1) / 90)),\r\n\t\t\tlet meterVolume = (meter ? meter.volume : 0) * $volumeCoefficient,\r\n\t\t\t\t// sensitivityCoefficient = (sensitivity / 10),\r\n\t\t\t\tsensitivityCoefficient = (sensitivity / 10),\r\n\t\t\t\tvolume = Math.min(25, meterVolume) * sensitivityCoefficient,\r\n\t\t\t\tvolumeMeter = volume.toFixed(1)\r\n\t\t\t\r\n\t\t\t// Clear the canvas\r\n\t\t\tcontext.clearRect(0, 0, width, height)\r\n\t\t\tawait drawImg(context, backgroundImage);\r\n\r\n\t\t\t// Block\r\n\t\t\tlet _blocks = [];\r\n\t\t\tblocks.subscribe(v => { _blocks = v })\r\n\t\t\t_blocks.forEach(block => {\r\n\t\t\t\tblock.update(player)\r\n\t\t\t})\r\n\r\n\t\t\t// Update & draw the player\r\n\t\t\tplayer.update(volume)\r\n\r\n\t\t\t// \r\n\t\t\tvolumeText.update(`Volume: ${volumeMeter}`)\r\n\t\t\tscoreText.update(`Score: ${$score}`)\r\n\t\t\tlevelText.update(`Level: ${$level}`)\r\n\r\n\t\t\t// Did it crash?\r\n\t\t\tif( player.crashed )\r\n\t\t\t{\r\n\t\t\t\tcrashScreen.style.display = 'flex'\r\n\t\t\t\trecycle.stop()\r\n\t\t\t}\r\n\t\t}, 1000 / 60)\r\n\t};\r\n\r\n\tfunction startGame()\r\n\t{\r\n\t\t// Initiate mounting\r\n\t\tmount()\r\n\r\n\t\t// remove the start button\r\n\t\tstartScreen.style.display = 'none'\r\n\t\taudioContext.resume()\r\n\t}\r\n\tfunction restartGame()\r\n\t{\r\n\t\t// \r\n\t\tcrashScreen.style.display = 'none'\r\n\t\t\r\n\t\t// update the score\r\n\t\tscore.set(0)\r\n\r\n\t\tmount()\r\n\t}\r\n\tfunction handleDomReady() {\r\n\t\t// create audio context\r\n\t\twindow.AudioContext = window.AudioContext || window.webkitAudioContext;\r\n\r\n\t\t// grab an audio context\r\n\t\taudioContext = new AudioContext();\r\n\t\tgetAudio()\r\n\t\thandleGameSizes()\r\n\t}\r\n\r\n\tfunction handleDomResize()\r\n\t{\r\n\t\thandleGameSizes()\r\n\t}\r\n\r\n\tfunction handleSensitivity()\r\n\t{\r\n\t\tsensitivityStore.set(sensitivity)\r\n\t}\r\n\r\n\tfunction handleGameSizes()\r\n\t{\r\n\t\t// ratio 8:1\r\n\t\twidth = window.innerWidth / 1.3\r\n\t\t$: height = width / 2.5\r\n\t}\r\n\r\n\tfunction getAudio() {\r\n\t\ttry {\r\n\t\t\t// monkeypatch getUserMedia\r\n\t\t\t// navigator.getUserMedia = \r\n\t\t\t// \tnavigator.getUserMedia ||\r\n\t\t\t// \tnavigator.webkitGetUserMedia ||\r\n\t\t\t// \tnavigator.mozGetUserMedia;\r\n\r\n\t\t\tnavigator.mediaDevices.getUserMedia({\r\n\t\t\t\t\"audio\": {\r\n\t\t\t\t\t\"mandatory\": {\r\n\t\t\t\t\t\t\"googEchoCancellation\": \"false\",\r\n\t\t\t\t\t\t\"googAutoGainControl\": \"false\",\r\n\t\t\t\t\t\t\"googNoiseSuppression\": \"false\",\r\n\t\t\t\t\t\t\"googHighpassFilter\": \"false\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"optional\": []\r\n\t\t\t\t}\r\n\t\t\t}).then(gotStream, () => { alert('We can\\'t reach your microphone') });\r\n\r\n\t\t\t// ask for an audio input\r\n\t\t\t// navigator.getUserMedia = ( navigator.getUserMedia ||\r\n   //                     navigator.webkitGetUserMedia ||\r\n   //                     navigator.mozGetUserMedia ||\r\n   //                     navigator.msGetUserMedia);\r\n\t\t\t// navigator.getUserMedia(\r\n\t\t\t// {\r\n\t\t\t// \t\"audio\": {\r\n\t\t\t// \t\t\"mandatory\": {\r\n\t\t\t// \t\t\t\"googEchoCancellation\": \"false\",\r\n\t\t\t// \t\t\t\"googAutoGainControl\": \"false\",\r\n\t\t\t// \t\t\t\"googNoiseSuppression\": \"false\",\r\n\t\t\t// \t\t\t\"googHighpassFilter\": \"false\"\r\n\t\t\t// \t\t},\r\n\t\t\t// \t\t\"optional\": []\r\n\t\t\t// \t},\r\n\t\t\t// }, gotStream, () => { console.log('Couldn\\'t get stream') });\r\n\t\t} catch (e) {\r\n\t\t\talert('getUserMedia threw exception 1 :' + e);\r\n\t\t}\r\n\t}\r\n\tfunction gotStream(stream) {\r\n\t\t// Create an AudioNode from the stream.\r\n\t\tmediaStreamSource = audioContext.createMediaStreamSource(stream);\r\n\r\n\t\t// Create a new volume meter and connect it.\r\n\t\tmeter = window.createAudioMeter(audioContext);\r\n\t\tmediaStreamSource.connect(meter);\r\n\t}\r\n\r\n\tfunction ebob(a, b) {\r\n\t\treturn (b == 0) ? a : gcd (b, a%b);\r\n    }\r\n\r\n\tasync function drawImg(context, image) {\r\n\t\treturn new Promise(resolve => {\r\n\t\t\timage.onload = function () {\r\n\t\t\t\tcontext.drawImage(image, 0, 0, image.width, $gameHeight);\r\n\t\t\t\tresolve(true);\r\n\t\t\t} \r\n\r\n\t\t\tif( image.naturalWidth != 0 )\r\n\t\t\t{\r\n\t\t\t\tcontext.drawImage(image, 0, 0, $gameWidth, $gameHeight+10);\r\n\t\t\t\tresolve(true)\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t:global(body) {\r\n\t\tuser-select: none;\r\n\t}\r\n\t#canvas-area {\r\n\t\t/*position: relative;*/\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tbackground: #fff\r\n\t}\r\n\r\n\t#playground {\r\n\t\tborder: 1px solid #999;\r\n\t\tbackground: #FFF;\r\n\t\tmargin: 0 auto;\r\n\t}\r\n\t#start-button {\r\n\t\tfont-size: 1.3rem;\r\n\t\tpadding: 0.8rem 1.4rem;\r\n\t\tcursor: pointer;\r\n\t}\r\n\t#sensitivity {\r\n\t\t/*position: absolute;*/\r\n\t\tmargin-top: 10px;\r\n\t}\r\n\t#start-screen {\r\n\t\tposition: absolute;\r\n\t\tbackground: rgba(000, 000, 000, 0.7);\r\n\t\tcolor: #FFF;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\ttop: 0; bottom: 0;\r\n\t\tleft: 0; right: 0;\r\n\t\ttext-align: center;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\t#start-screen .emoji {\r\n\t\tfont-size: 3rem;\r\n\t\tfont-weight: normal;\r\n\t\tmargin-bottom: 0.8rem;\r\n\t}\r\n\t#start-screen .message {\r\n\t\tfont-size: 1.2rem;\r\n\t\tfont-weight: normal;\r\n\t\tfont-style: italic;\r\n\t\tmargin-bottom: 3rem;\r\n\t}\r\n\t#crash-screen {\r\n\t\tposition: absolute;\r\n\t\tbackground: rgba(000, 000, 000, 0.7);\r\n\t\tcolor: #FFF;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\ttop: 0; bottom: 0;\r\n\t\tleft: 0; right: 0;\r\n\t\ttext-align: center;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tdisplay: none;\r\n\t}\r\n\t#crash-screen .message {\r\n\t\tfont-size: 1.2rem;\r\n\t\tfont-weight: normal;\r\n\t\tfont-style: italic;\r\n\t\tmargin-bottom: 0.8rem;\r\n\t}\r\n\t#crash-screen .score {\r\n\t\tfont-size: 2rem;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\t#crash-screen #restart-button {\r\n\t\tfont-size: 1.5rem;\r\n\t\tmargin-top: 2rem;\r\n\t\tfont-weight: bold;\r\n\t\tpadding: 0.8rem 1.4rem;\r\n\t\tcursor: pointer;\r\n\t}\r\n\t\r\n\th1#title {\r\n\t\tmargin-bottom: 0;\r\n\t}\r\n\t#link-area {\r\n\t\tfont-size: 0.8rem; text-align: center; font-style: italic; margin-top: 5px; margin-bottom: 10px\r\n\t}\r\n\t#link {\r\n\t\tfont-style:normal;font-weight:bold; color: #333; text-decoration: none !important\r\n\t}\r\n\t#ma-text {\r\n\t\tbackground-color:#D32F2F;color:#FFF;padding:0 4px\r\n\t}\r\n</style>\r\n<svelte:head>\r\n\t<title>FlappyDirt ðŸ’© v0.8 - MALab [muratalabacak.com]</title>\r\n</svelte:head>\r\n<svelte:window on:resize={handleDomResize} on:load={handleDomReady}/>\r\n\r\n<div id=\"canvas-area\">\r\n\t\r\n\t<h1 id=\"title\">FlappyDirt</h1>\r\n\t<div id=\"link-area\">\r\n\t\tThis is a product of <a href=\"http://muratalabacak.com\" target=\"_blank\" id=\"link\"><span id=\"ma-text\">MA</span>Lab</a>\r\n\t</div>\r\n\r\n\r\n\t<canvas\r\n\t\tid=\"playground\"\r\n\t\tbind:this={canvas}\r\n\t\twidth={width}\r\n\t\theight={height}\r\n\t/>\r\n\t<div id=\"start-screen\" bind:this={startScreen}>\r\n\t\t<div class=\"emoji\">\r\n\t\t\tðŸ˜Š\r\n\t\t</div>\r\n\t\t<div class=\"message\">\r\n\t\t\tYou can always adjust your mic sensitivity below!\r\n\t\t</div>\r\n\t\t<button id=\"start-button\" on:click={startGame} bind:this={startButton}>Start</button>\r\n\t</div>\r\n\t<div id=\"sensitivity\" style=\"bottom: -50px\">\r\n\t\tSensitivity ({sensitivity}):\r\n\t\t<input min=\"-100\" max=\"100\" type=\"range\" on:input={handleSensitivity} bind:value={sensitivity}>\r\n\t</div>\r\n\r\n\t<div id=\"crash-screen\" bind:this={crashScreen}>\r\n\t\t<div class=\"message\">\r\n\t\t\tDid you try adjusting your volume sensitivity?\r\n\t\t</div>\r\n\t\t<div class=\"score\">\r\n\t\t\tScore: {$score}\r\n\t\t</div>\r\n\r\n\t\t<button id=\"restart-button\" on:click={restartGame} bind:this={restartButton}>Restart</button>\r\n\t</div>\r\n</div>"
  ],
  "names": [],
  "mappings": "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"
}